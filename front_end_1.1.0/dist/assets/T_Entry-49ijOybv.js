import{_,d as h,c as n,e as t,n as f,f as a,v as m,g as p,b as u,t as g,h as b,o as d,p as w,i as y}from"./index-BBbOrejx.js";const k={name:"login-register",data(){return{isLogin:!0,stateReg:!1,emailError:!1,passwordError:!1,existed:!1,form:{name:"",tid:"",email:"",password:"",password2:"",code:"",phone:""},show:!0,count:"",timer:null}},methods:{studentEntry(){this.$router.push("/studentLogin")},changeType(){this.isLogin=!this.isLogin,this.stateReg=!1,this.form.tid="",this.form.name="",this.form.email="",this.form.password=""},teacherForgetPwd(){this.$router.push("/teacherForgetPwd")},sendCode(){this.timer||(console.log("已发送"),h({method:"post",url:"user/forget/sendCode",data:{acc:this.form.phone}}).then(e=>{console.log(e.error_code),alert("验证码已发送，请在手机信息中查看。")}),this.count=60,this.show=!1,this.timer=setInterval(()=>{this.count>0&&this.count<=60?this.count--:(this.show=!0,clearInterval(this.timer),this.timer=null)},1e3))},changeRegState(){this.form.sid!=""&&this.form.name!=""&&this.form.college!=""?this.stateReg=!this.stateReg:alert("填写不能为空！")},changePwd(){this.form.email!=""&&this.form.password!=""&&h({method:"post",url:"manager/resetPwd",data:{uid:this.userId,old_pwd:this.form.password,new_pwd:this.new_password}}).then(i=>{switch(i.error_code){case 0:alert("登录成功");break;case 1:alert("请求参数错误");break;case 2:alert("原密码错误");break;case 3:alert("新密码格式错误");break;case 4:alert("用户不存在");break}})},login(){localStorage.setItem("token","wutoken");var i=localStorage.getItem("token");console.log(i),this.form.email!=""&&this.form.password!=""?h.post("manager/Login",{acc:this.form.email,pwd:this.form.password}).then(e=>{console.log(h.defaults.baseURL);let c={};c.Mail=this.form.email,c.UID=e.data.uid,c.hash_code=e.data.hash_code,console.log(c.hash_code),e.data.error_code==0?(localStorage.setItem("uid",e.data.uid),localStorage.setItem("Mail",this.form.email),localStorage.setItem("isSuperUser",e.data.is_superUser),localStorage.setItem("token",e.data.hash_code),e.data.is_superUser?(this.$router.push("/borrowProcessing"),this.$store.commit("changeLogin",c)):(this.$router.push("/settools"),this.$store.commit("changeLogin",c))):e.data.error_code==1?alert("存在输入为空！"):e.data.error_code==2?alert("用户不存在！"):e.data.error_code==3?alert("密码错误！请重新输入。"):alert("请重新输入！")}):alert("填写不能为空")},register(){console.log(this.form.phone+" : "+this.form.tid),this.form.password!=""&&this.form.email!=""?this.form.password!=this.form.password2?alert("两次密码输入不一致。"):h({method:"post",url:"manager/RegisterTeacherAcc",data:{acc:this.form.email,teacherId:this.form.tid,name:this.form.name,pwd:this.form.password,key:this.form.code,phoneNumber:this.form.phone}}).then(i=>{console.log(i),i.data.error_code==0&&(alert("您的注册请求已提交！请等待管理员审核。"),this.changeType()),i.data.error_code==1&&alert("输入有误！请检查并重新输入"),i.data.error_code==2&&alert("该邮箱已注册！")}):alert("填写不能为空！")}}},r=i=>(w("data-v-7f71195a"),i=i(),y(),i),v={class:"login-register"},C=r(()=>t("div",{class:"header"},null,-1)),T={class:"contain"},I={key:0,class:"big-contain"},S=r(()=>t("div",{class:"btitle"},"教师登录",-1)),U={class:"bform"},x={key:0,class:"errTips"},E={key:1,class:"errTips"},L={key:1,class:"big-contain"},R={key:0},V=r(()=>t("div",{class:"btitle"},"教师注册",-1)),N=r(()=>t("br",null,null,-1)),P={class:"bform"},M=r(()=>t("br",null,null,-1)),F={key:0,class:"errTips"},B=r(()=>t("br",null,null,-1)),D=r(()=>t("br",null,null,-1)),O=r(()=>t("br",null,null,-1)),z={key:1},A={class:"btitle"},j={class:"bform"},q=r(()=>t("br",null,null,-1)),G=r(()=>t("br",null,null,-1)),H=r(()=>t("br",null,null,-1)),J=r(()=>t("br",null,null,-1)),K={key:0,class:"small-contain"},Q=r(()=>t("div",{class:"stitle"},[u("北航工程训练中心"),t("br"),u("工具信息平台")],-1)),W=r(()=>t("p",{class:"scontent"},[u("请输入您的邮箱"),t("br"),u("或管理员账号")],-1)),X=r(()=>t("br",null,null,-1)),Y={key:1,class:"small-contain"},Z=r(()=>t("div",{class:"stitle"},"老师，您好！",-1)),$=r(()=>t("p",{class:"scontent"},[u("注册工训中心账号，"),t("br"),u("轻松管理设备借还。")],-1)),ee=r(()=>t("br",null,null,-1));function te(i,e,c,se,o,l){return d(),n("div",v,[C,t("div",T,[t("div",{class:f(["big-box",{active:o.isLogin}])},[o.isLogin?(d(),n("div",I,[S,t("div",U,[a(t("input",{type:"email",placeholder:"邮箱","onUpdate:modelValue":e[0]||(e[0]=s=>o.form.email=s)},null,512),[[m,o.form.email]]),o.emailError?(d(),n("span",x,"* 邮箱填写错误 *")):p("",!0),a(t("input",{type:"password",placeholder:"密码","onUpdate:modelValue":e[1]||(e[1]=s=>o.form.password=s)},null,512),[[m,o.form.password]]),o.emailError?(d(),n("span",E,"* 密码填写错误 *")):p("",!0)]),t("button",{class:"bbutton",onClick:e[2]||(e[2]=(...s)=>l.login&&l.login(...s))},"登录"),u("   "),t("button",{class:"bbutton",onClick:e[3]||(e[3]=(...s)=>l.teacherForgetPwd&&l.teacherForgetPwd(...s))},"忘记密码")])):(d(),n("div",L,[o.stateReg?(d(),n("div",z,[t("div",A,"欢迎，"+g(this.form.name)+"老师！",1),t("div",j,[a(t("input",{type:"text",placeholder:"手机号","onUpdate:modelValue":e[8]||(e[8]=s=>o.form.phone=s)},null,512),[[m,o.form.phone]]),q,t("button",{onClick:e[9]||(e[9]=(...s)=>l.sendCode&&l.sendCode(...s))},[u("获取验证码"),a(t("span",{class:"count"},g(o.count)+" s",513),[[b,!o.show]])]),G,a(t("input",{type:"code",placeholder:"验证码","onUpdate:modelValue":e[10]||(e[10]=s=>o.form.code=s)},null,512),[[m,o.form.code]]),H,a(t("input",{type:"password",placeholder:"密码","onUpdate:modelValue":e[11]||(e[11]=s=>o.form.password=s)},null,512),[[m,o.form.password]]),J,a(t("input",{type:"password",placeholder:"确认密码","onUpdate:modelValue":e[12]||(e[12]=s=>o.form.password2=s)},null,512),[[m,o.form.password2]])]),t("button",{class:"bbutton",onClick:e[13]||(e[13]=(...s)=>l.changeRegState&&l.changeRegState(...s))},"上一步"),u("  "),t("button",{class:"bbutton",onClick:e[14]||(e[14]=(...s)=>l.register&&l.register(...s))},"注册")])):(d(),n("div",R,[V,N,t("div",P,[a(t("input",{type:"text",placeholder:"工号","onUpdate:modelValue":e[4]||(e[4]=s=>o.form.tid=s)},null,512),[[m,o.form.tid]]),M,o.existed?(d(),n("span",F,"* 该工号已经注册！ *")):p("",!0),a(t("input",{type:"text",placeholder:"姓名","onUpdate:modelValue":e[5]||(e[5]=s=>o.form.name=s)},null,512),[[m,o.form.name]]),B,a(t("input",{type:"text",placeholder:"邮箱","onUpdate:modelValue":e[6]||(e[6]=s=>o.form.email=s)},null,512),[[m,o.form.email]]),D]),O,t("button",{class:"bbutton",onClick:e[7]||(e[7]=(...s)=>l.changeRegState&&l.changeRegState(...s))},"下一步")]))]))],2),t("div",{class:f(["small-box",{active:o.isLogin}])},[o.isLogin?(d(),n("div",K,[Q,W,t("button",{class:"sbutton",onClick:e[15]||(e[15]=(...s)=>l.changeType&&l.changeType(...s))},"前往注册"),X,t("button",{class:"sbutton",onClick:e[16]||(e[16]=(...s)=>l.studentEntry&&l.studentEntry(...s))},"学生入口")])):(d(),n("div",Y,[Z,$,t("button",{class:"sbutton",onClick:e[17]||(e[17]=(...s)=>l.changeType&&l.changeType(...s))},"前往登录"),ee,t("button",{class:"sbutton",onClick:e[18]||(e[18]=(...s)=>l.studentEntry&&l.studentEntry(...s))},"学生入口")]))],2)])])}const le=_(k,[["render",te],["__scopeId","data-v-7f71195a"]]);export{le as default};
