import{H as j}from"./HeadBar-DcpOYb3W.js";import{S as M}from"./StudentMenu-C5pUSryS.js";import{_ as k,a as y,r as c,o as r,c as d,b as o,t as n,h as i,i as a,k as F,F as C,l as T,e as _,d as m,j as V,p as S,g as B}from"./index-BiNYOpqX.js";import"./headerLogo-CGJBKw5C.js";const H={name:"BTSelectTool",components:{},created(){},mounted(){this.init()},props:["tagid"],data(){return{searchkey:"",tools:[],totoftags:1,rescount:0,dialogVisible:!1,thetool:{name:"",totalCount:null,leftCount:null,borrowCount:1,begin:"",end:"",purpose:""},Infodialog:!1,borrowSuccess:!1,rules:{borrowCount:[],duration:[{required:!0,message:"请选择借用的时段",trigger:"blur"}],purpose:[{required:!0,message:"请填写借用理由",trigger:"blur"}]}}},methods:{init(){y({url:"user/getLabelToolList",method:"post",data:{labelId:this.tagid}}).then(e=>{e.data.error_code==0?(console.log(e),this.tools=e.data.toolList,this.rescount=e.data.toolList.length):console.log(error)}).catch(e=>{console.log(e)})},ToolInfo(e){this.thetool=e,this.Infodialog=!0},borrowTool(e){this.thetool=e,this.thetool.borrowCount=1,this.borrowSuccess=!1,this.dialogVisible=!0},formatDate(e){return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()},changeDuration(e){this.thetool.begin=e[0],this.thetool.end=e[1]},confirmBorrow(){this.$refs.thetool.validate(e=>{e?y({url:"user/borrowRequest",method:"post",data:{toolId:this.thetool.id,uid:localStorage.getItem("uid"),borrowCount:1,returnTime:this.formatDate(this.thetool.end),startTime:this.formatDate(this.thetool.begin),purpose:this.thetool.purpose}}).then(l=>{console.log("Miaomiaomiao",l),l.data.error_code==0?this.borrowSuccess=!0:l.data.error_code==4?this.$message.warning("借用时长超过限定期限"):l.data.error_code==5?this.$message.warning("你已经借用过这个工具了"):this.$message.error("错误代码",l.data.error_code)}).catch(l=>{this.$message.error("系统安全错误，请重试！",l)}):this.$message.error("输入错误",err)})},searchtool(){this.searchkey.length<1?this.init():y({url:"user/searchToolByName",method:"post",data:{toolName:this.searchkey}}).then(e=>{this.tools=e.data.dataList,this.rescount=e.data.dataList.length}).catch(e=>{this.$message.error(e)})},chooseTool(e){console.log(e)}}},q=e=>(S("data-v-f8a67f7c"),e=e(),B(),e),z={style:{width:"100%",display:"grid","grid-template-rows":"40px auto","row-gap":"30px"}},K={style:{display:"grid","grid-template-columns":"20% 40% 40%","align-items":"center"}},R={style:{display:"grid","grid-template-columns":"repeat(auto-fill,160px)","grid-template-rows":"repeat(auto-fill,250px)",gap:"30px 30px"}},E=["onClick"],Y={style:{width:"150px",height:"150px",margin:"5px auto"}},A={style:{height:"30px","line-height":"30px",width:"160px"}},G={style:{height:"40px",width:"160px","margin-top":"10px",display:"inline-block"}},J={key:0,style:{width:"100%",display:"grid","grid-template-rows":"100px 200px 50px auto 100px","justify-items":"center"}},O={class:"borrow-tool-title"},P={style:{width:"200px",height:"200px",margin:"0 auto"}},Q=["src"],W={class:"borrow-tool-text",style:{"line-height":"50px"}},X={key:0},Z={class:"borrow-tool-text"},$={style:{display:"flex","justify-content":"space-evenly"}},ee={slot:"extra"},te={style:{width:"100%",display:"grid","grid-template-rows":"100px 200px 50px auto 100px","justify-items":"center"}},oe={class:"borrow-tool-title"},le={style:{width:"200px",height:"200px",margin:"0 auto"}},se=["src"],ie={class:"borrow-tool-text",style:{"line-height":"50px"}},ne={key:0},re={class:"borrow-tool-text",style:{display:"grid","grid-template-columns":"100px 400px"}},ae=q(()=>o("div",{style:{"font-weight":"bold"}},"详情介绍:",-1));function de(e,l,I,L,t,u){const h=c("el-button"),g=c("el-input"),x=c("el-image"),p=c("el-input-number"),f=c("el-form-item"),D=c("el-date-picker"),N=c("el-form"),U=c("el-result"),b=c("el-dialog");return r(),d("div",z,[o("div",K,[o("span",null,"共 "+n(t.rescount)+" 条结果",1),o("span",null,[i(g,{style:{width:"400px","margin-left":"100px"},placeholder:"支持模糊搜索工具名称",modelValue:t.searchkey,"onUpdate:modelValue":l[0]||(l[0]=s=>t.searchkey=s),onKeyup:F(u.searchtool,["enter","native"])},{default:a(()=>[i(h,{slot:"append",icon:"el-icon-search",onClick:u.searchtool},null,8,["onClick"])]),_:1},8,["modelValue","onKeyup"])])]),o("div",R,[(r(!0),d(C,null,T(t.tools,s=>(r(),d("div",{class:"tagselect-onetag",onClick:v=>u.chooseTool(s)},[o("div",Y,[i(x,{style:{height:"100%",width:"100%","border-radius":"5px"},src:s.url,fit:e.fill},null,8,["src","fit"])]),o("div",A,n(s.name),1),o("div",G,[i(h,{size:"small",style:{"margin-top":"5px"},onClick:v=>u.ToolInfo(s)},{default:a(()=>[_("详情")]),_:2},1032,["onClick"]),i(h,{type:"primary",size:"small",style:{"margin-top":"5px"},onClick:v=>u.borrowTool(s)},{default:a(()=>[_("借用")]),_:2},1032,["onClick"])])],8,E))),256)),i(b,{modelValue:t.dialogVisible,"onUpdate:modelValue":l[6]||(l[6]=s=>t.dialogVisible=s),center:"",modal:!0,"append-to-body":!0,width:"700px",top:"5px"},{default:a(()=>[t.borrowSuccess==!1?(r(),d("div",J,[o("div",O,"借用 "+n(t.thetool.name),1),o("div",P,[o("img",{height:"100%",width:"100%",src:t.thetool.url},null,8,Q)]),o("div",W,[o("span",null,"限借天数："+n(t.thetool.limit_days),1),o("span",null,"  总数："+n(t.thetool.totalCount),1),o("span",null,"  剩余数量："+n(t.thetool.leftCount),1),t.thetool.leftCount==0?(r(),d("span",X," 归还时间："+n(t.thetool.shortReturnTime),1)):m("",!0)]),o("div",Z,[i(N,{ref:"thetool",model:t.thetool,rules:t.rules,style:{"margin-top":"3vh","line-height":"50px"},"label-width":"200px"},{default:a(()=>[i(f,{label:"要借用此工具的数量",prop:"borrowCount"},{default:a(()=>[i(p,{style:{width:"100%"},modelValue:t.thetool.borrowCount,"onUpdate:modelValue":l[1]||(l[1]=s=>t.thetool.borrowCount=s),max:t.thetool.leftCount,min:1},null,8,["modelValue","max"])]),_:1}),i(f,{label:"借用时间",prop:"duration"},{default:a(()=>[i(D,{modelValue:t.thetool.duration,"onUpdate:modelValue":l[2]||(l[2]=s=>t.thetool.duration=s),type:"daterange","range-separator":"至","start-placeholder":"开始借用日期","end-placeholder":"归还日期",onChange:u.changeDuration},null,8,["modelValue","onChange"])]),_:1}),i(f,{label:"借用理由",prop:"purpose"},{default:a(()=>[i(g,{type:"textarea",rows:2,style:{width:"300px"},placeholder:"请输入内容",modelValue:t.thetool.purpose,"onUpdate:modelValue":l[3]||(l[3]=s=>t.thetool.purpose=s)},null,8,["modelValue"])]),_:1}),o("div",$,[i(h,{onClick:l[4]||(l[4]=s=>t.dialogVisible=!1)},{default:a(()=>[_("取 消")]),_:1}),i(h,{type:"primary",onClick:u.confirmBorrow},{default:a(()=>[_("确 定")]),_:1},8,["onClick"])])]),_:1},8,["model","rules"])])])):(r(),V(U,{key:1,icon:"success",title:"借用工具成功","sub-title":"请关注相关提醒邮件"},{default:a(()=>[o("template",ee,[i(h,{type:"primary",size:"medium",onClick:l[5]||(l[5]=s=>t.dialogVisible=!1)},{default:a(()=>[_("返回工具页")]),_:1})])]),_:1}))]),_:1},8,["modelValue"]),i(b,{modelValue:t.Infodialog,"onUpdate:modelValue":l[7]||(l[7]=s=>t.Infodialog=s),center:"",modal:!0,"append-to-body":!0,width:"700px",top:"5px"},{default:a(()=>[o("div",te,[o("div",oe,n(t.thetool.name),1),o("div",le,[o("img",{height:"100%",width:"100%",src:t.thetool.url},null,8,se)]),o("div",ie,[o("span",null,"限借天数："+n(t.thetool.limit_days),1),o("span",null,"  总数："+n(t.thetool.totalCount),1),o("span",null,"  剩余数量："+n(t.thetool.leftCount),1),t.thetool.leftCount==0?(r(),d("span",ne," 归还时间："+n(t.thetool.shortReturnTime),1)):m("",!0)]),o("div",re,[ae,o("div",null,n(t.thetool.intro),1)])])]),_:1},8,["modelValue"])])])}const ce=k(H,[["render",de],["__scopeId","data-v-f8a67f7c"]]),ue={name:"borrowTools",components:{BTSelectTool:ce,HeadBar:j,StudentMenu:M},data(){return{tagid:0,tagname:"",labellist:[],toolcount:0}},mounted(){y({url:"user/getFirstLabelList",method:"post",data:{}}).then(e=>{e.data.error_code==0?(this.labellist=e.data.labelList,console.log(this.labellist[0].lowerLabel)):this.$message.error(e.error_code)})},methods:{chooseTag(e){this.tagid=e.id,this.tagname=e.name},cancelTag(){this.tagid=0,this.tagname=""}}},w=e=>(S("data-v-e5cdfb49"),e=e(),B(),e),he={style:{display:"grid","grid-template-columns":"20% 75% 5%"}},pe={class:"tagselect-frame"},me=w(()=>o("div",{class:"tagselect-title"},"工具借用",-1)),_e={class:"tagselect-path"},ge={key:1},fe={key:2},ye={class:"tagselect-content"},xe={key:0},we={style:{display:"grid","grid-template-columns":"repeat(3,300px)","grid-template-rows":"400px","column-gap":"100px","justify-content":"space-around"}},be=w(()=>o("div",null,null,-1)),ve=["onClick"],ke={style:{width:"100%",height:"300px"}},Ce=["src"],Te={class:"tagselect-onetype-title"},Ve=w(()=>o("div",null,null,-1));function Se(e,l,I,L,t,u){const h=c("HeadBar"),g=c("StudentMenu"),x=c("BTSelectTool");return r(),d("div",null,[i(h),o("div",he,[o("div",null,[i(g)]),o("div",pe,[me,o("div",_e,[t.tagid>0?(r(),d("span",{key:0,style:{cursor:"pointer"},onClick:l[0]||(l[0]=(...p)=>u.cancelTag&&u.cancelTag(...p))},"类别")):m("",!0),t.tagid>0?(r(),d("span",ge,"   >>   ")):m("",!0),t.tagid>0?(r(),d("span",fe,n(t.tagname),1)):m("",!0)]),o("div",ye,[t.tagid==0?(r(),d("div",xe,[o("div",we,[(r(!0),d(C,null,T(t.labellist,p=>(r(),d("div",null,[be,o("div",{class:"tagselect-onetype",onClick:f=>u.chooseTag(p.lowerLabel[0])},[o("div",ke,[o("img",{style:{height:"100%",width:"100%"},src:p.lowerLabel[0].url},null,8,Ce)]),o("h3",Te,n(p.lowerLabel[0].name),1)],8,ve)]))),256))])])):m("",!0),t.tagid>0?(r(),V(x,{key:1,tagid:t.tagid},null,8,["tagid"])):m("",!0)])]),Ve])])}const Ne=k(ue,[["render",Se],["__scopeId","data-v-e5cdfb49"]]);export{Ne as default};
