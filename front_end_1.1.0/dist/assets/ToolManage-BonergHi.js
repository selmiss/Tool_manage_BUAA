import{_ as C,d as y,E as R,o as r,c as m,e as l,t as d,a as i,w as n,k as q,F as T,l as L,g as _,j as D,b as h,r as u,p as U,i as M}from"./index-56bR-A_b.js";import{T as z}from"./TeacherHeadBar-DnYuqNtp.js";import{T as F}from"./TeacherMenu-BzY2X5kO.js";import"./headerLogo-CGJBKw5C.js";const N={file:null,name:"ToolSelectMan",components:{},mounted(){this.init()},props:["tagid"],data(){return{searchkey:"",fulltools:[],tools:[{id:0,name:"",total_count:0,left_count:0,label:"",portrait:"",created_at:"",intro:"",limit_days:0}],rescount:0,formLoading:!1,editButtonLoading:!1,infoDialog:!1,editDialog:!1,delDialog:!1,cur_tool:{},form:{id:0,name:"",total_count:1,img:"",imgfile:null,intro:"暂无简介",limit_days:7},rules:{name:[{required:!0,message:"请输入工具名称",trigger:"blur"}],labelId:[{required:!0,message:"请选择分类",trigger:"blur"}],img:[{required:!0,message:"请上传工具图片",trigger:"blur"}],addCount:[{required:!0,message:"请输入工具数量",trigger:"blur"}],limit_days:[{required:!0,message:"请输入工具的限制借用天数",trigger:"blur"}],intro:[]}}},methods:{handleChange(t,o){this.form.img=URL.createObjectURL(t.raw),this.form.imgfile=t.raw},init(){y({url:"tools",method:"get",params:{label:this.tagid}}).then(t=>{this.tools=t.data.data,this.tools.map(o=>{o.portrait.startsWith("http")?o.portrait=o.portrait:o.portrait=y.defaults.baseURL+"media/image/"+o.portrait}),this.rescount=t.data.data.length,this.fulltools=this.tools,console.log(this.tools)}).catch(t=>{this.$message.error(t)})},searchtool(){this.searchkey.length<1?this.init():this.tools=this.fulltools.filter(t=>t.name.includes(this.searchkey))},pre_del(t){this.cur_tool=t,this.delDialog=!0},del(){y({url:"tools/"+this.cur_tool.id,method:"DELETE"}).then(t=>{this.delDialog=!1,this.init()}).catch(t=>{R.error(t)})},info(t){this.cur_tool=t,this.infoDialog=!0},pre_edit(t){this.cur_tool=t,this.form=t,this.form.img=t.portrait,this.form.imgfile=null,this.editDialog=!0},edit(){this.formLoading||this.$refs.form.validate(t=>{if(t){this.formLoading=!0;var o=new FormData;o.append("name",this.form.name),o.append("total_count",this.form.total_count),o.append("intro",this.form.intro),o.append("limit_days",this.form.limit_days),o.append("img",this.form.imgfile),y({url:"tools/"+this.form.id,method:"put",data:o}).then(x=>{this.formLoading=!1,this.editDialog=!1,this.init()}).catch(x=>{this.$message.error(x),this.formLoading=!1})}})}}},B=t=>(U("data-v-78a1ae84"),t=t(),M(),t),H={style:{width:"100%",display:"grid","grid-template-rows":"40px auto","row-gap":"30px"}},K={style:{display:"grid","grid-template-columns":"20% 40% 40%","align-items":"center"}},P={style:{display:"grid","grid-template-columns":"repeat(auto-fill,160px)","grid-template-rows":"repeat(auto-fill,250px)",gap:"30px 30px"}},O={class:"tagselect-onetag"},W=["onClick"],A={style:{height:"30px",width:"160px"}},G={style:{height:"40px",width:"160px","margin-top":"10px",display:"inline-block"}},J={style:{width:"100%",display:"grid","grid-template-rows":"100px 200px 50px auto 100px","justify-items":"center"}},Q={class:"borrow-tool-title"},X={style:{width:"200px",height:"200px",margin:"0 auto"}},Y={class:"borrow-tool-text",style:{"line-height":"50px"}},Z={key:0},$={class:"borrow-tool-text",style:{display:"grid","grid-template-columns":"100px 400px"}},ee=B(()=>l("div",{style:{"font-weight":"bold"}},"详情介绍:",-1)),te={style:{width:"100%",display:"grid","grid-template-rows":"100px auto","justify-items":"center"}},oe=B(()=>l("div",{class:"borrow-tool-title"},"编辑工具",-1)),le={style:{display:"grid","grid-template-columns":"400px 500px","grid-template-rows":"400px 100px","column-gap":"50px"}},ie=["src"],se={key:0},ne={style:{"grid-column-start":"span 2","justify-self":"center"}},re={class:"text-red-800"};function ae(t,o,x,j,e,a){const p=u("el-button"),f=u("el-input"),v=u("el-image"),c=u("el-icon"),w=u("el-dialog"),g=u("el-form-item"),I=u("Plus"),E=u("el-upload"),k=u("el-input-number"),V=u("el-form");return r(),m("div",H,[l("div",K,[l("span",null,"共 "+d(e.rescount)+" 条结果",1),l("span",null,[i(f,{style:{width:"400px","margin-left":"100px"},placeholder:"支持模糊搜索工具名称",modelValue:e.searchkey,"onUpdate:modelValue":o[0]||(o[0]=s=>e.searchkey=s),onKeyup:q(a.searchtool,["enter","native"])},{default:n(()=>[i(p,{slot:"append",icon:"el-icon-search",onClick:a.searchtool},null,8,["onClick"])]),_:1},8,["modelValue","onKeyup"])])]),l("div",P,[(r(!0),m(T,null,L(e.tools,s=>(r(),m("div",O,[l("div",{style:{width:"150px",height:"150px",margin:"5px auto"},onClick:b=>a.info(s)},[i(v,{style:{height:"100%",width:"100%","border-radius":"5px"},src:s.portrait,fit:t.fill},null,8,["src","fit"])],8,W),l("div",A,d(s.name),1),l("div",G,[i(p,{size:"small",style:{"margin-top":"5px"},onClick:b=>a.info(s)},{default:n(()=>[i(c,{class:"el-icon-info"})]),_:2},1032,["onClick"]),i(p,{type:"primary",size:"small",style:{"margin-top":"5px"},loading:e.editButtonLoading,onClick:b=>a.pre_edit(s)},{default:n(()=>[i(c,{class:"el-icon-edit"})]),_:2},1032,["loading","onClick"]),i(p,{type:"danger",size:"small",style:{"margin-top":"5px"},onClick:b=>a.pre_del(s)},{default:n(()=>[i(c,{class:"el-icon-delete"})]),_:2},1032,["onClick"])])]))),256)),i(w,{modelValue:e.infoDialog,"onUpdate:modelValue":o[1]||(o[1]=s=>e.infoDialog=s),center:"",modal:!0,"append-to-body":!0,width:"700px",top:"5px"},{default:n(()=>[l("div",J,[l("div",Q,d(e.cur_tool.name),1),l("div",X,[i(v,{style:{height:"100%",width:"100%","border-radius":"5px"},src:e.cur_tool.portrait,fit:t.fill},null,8,["src","fit"])]),l("div",Y,[l("span",null,"限借天数："+d(e.cur_tool.limit_days),1),l("span",null,"  总数："+d(e.cur_tool.total_count),1),l("span",null,"  剩余数量："+d(e.cur_tool.left_count),1),e.cur_tool.leftCount==0?(r(),m("span",Z," 归还时间："+d(e.cur_tool.shortReturnTime),1)):_("",!0)]),l("div",$,[ee,l("div",null,d(e.cur_tool.intro),1)])])]),_:1},8,["modelValue"]),i(w,{modelValue:e.editDialog,"onUpdate:modelValue":o[7]||(o[7]=s=>e.editDialog=s),center:"",modal:!0,"append-to-body":!0,width:"1000px",top:"5px"},{default:n(()=>[i(V,{ref:"form",model:e.form,rules:e.rules,"label-width":"80px"},{default:n(()=>[l("div",te,[oe,i(V,{ref:"form",model:e.form,rules:e.rules,"label-width":"80px"},{default:n(()=>[l("div",le,[l("div",null,[i(g,{label:"工具名称",prop:"name"},{default:n(()=>[i(f,{modelValue:e.form.name,"onUpdate:modelValue":o[2]||(o[2]=s=>e.form.name=s)},null,8,["modelValue"])]),_:1}),i(g,{label:"工具图片"},{default:n(()=>[i(E,{class:"avatar-uploader",accept:"image/jpeg,image/jpg,image/png","auto-upload":!1,"show-file-list":!1,action:"","on-change":a.handleChange},{default:n(()=>[e.form.img?(r(),m("img",{key:0,src:e.form.img,class:"avatar"},null,8,ie)):(r(),D(c,{key:1,class:"el-icon--upload"},{default:n(()=>[i(I)]),_:1}))]),_:1},8,["on-change"])]),_:1}),i(g,{label:"工具数量",prop:"addCount"},{default:n(()=>[i(k,{modelValue:e.form.total_count,"onUpdate:modelValue":o[3]||(o[3]=s=>e.form.total_count=s),min:1},null,8,["modelValue"]),l("div",null,"剩余数量："+d(e.cur_tool.left_count),1),e.cur_tool.left_count==0?(r(),m("div",se," 归还时间："+d(e.cur_tool.shortReturnTime),1)):_("",!0)]),_:1})]),l("div",null,[i(g,{label:"限借天数",prop:"limit_days"},{default:n(()=>[i(k,{style:{width:"100%"},modelValue:e.form.limit_days,"onUpdate:modelValue":o[4]||(o[4]=s=>e.form.limit_days=s),min:1},null,8,["modelValue"])]),_:1}),i(g,{label:"工具详情",prop:"intro"},{default:n(()=>[i(f,{type:"textarea",autosize:{minRows:14},placeholder:"请输入内容",modelValue:e.form.intro,"onUpdate:modelValue":o[5]||(o[5]=s=>e.form.intro=s)},null,8,["modelValue"])]),_:1})]),l("div",ne,[i(g,null,{default:n(()=>[i(p,{style:{width:"200px"},type:"primary",onClick:a.edit,loading:e.formLoading},{default:n(()=>[h("确定")]),_:1},8,["onClick","loading"]),i(p,{style:{width:"200px"},onClick:o[6]||(o[6]=s=>e.editDialog=!1)},{default:n(()=>[h("取消")]),_:1})]),_:1})])])]),_:1},8,["model","rules"])])]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),i(w,{modelValue:e.delDialog,"onUpdate:modelValue":o[10]||(o[10]=s=>e.delDialog=s),width:"30%"},{footer:n(()=>[i(p,{type:"danger",onClick:o[8]||(o[8]=s=>a.del(t.tool))},{default:n(()=>[h("确认")]),_:1}),i(p,{onClick:o[9]||(o[9]=s=>e.delDialog=!1)},{default:n(()=>[h("取消")]),_:1})]),default:n(()=>[l("p",null,[h("您确定要删除 "),l("span",re,d(e.cur_tool.name),1),h(" 工具吗？")])]),_:1},8,["modelValue"])])])}const de=C(N,[["render",ae],["__scopeId","data-v-78a1ae84"]]),ue={name:"ToolManagement",components:{TeacherHeadBar:z,TeacherMenu:F,ToolSelectMan:de},data(){return{tagid:0,tagname:"",labellist:[],toolcount:0}},mounted(){y({url:"user/getFirstLabelList",method:"post",data:{}}).then(t=>{t.data.error_code==0?(this.labellist=t.data.labelList,console.log(this.labellist[0].lowerLabel)):this.$message.error(t.error_code)})},methods:{chooseTag(t){this.tagid=t.id,this.tagname=t.name},cancelTag(){this.tagid=0,this.tagname=""}}},S=t=>(U("data-v-13f50a81"),t=t(),M(),t),me={style:{display:"grid","grid-template-columns":"15% 80% 5%"}},pe={class:"tagselect-frame"},ce=S(()=>l("div",{class:"tagselect-title"},"编辑工具",-1)),_e={class:"tagselect-path"},ge={key:1},he={key:2},fe={class:"tagselect-content"},ye={key:0},xe={style:{display:"grid","grid-template-columns":"repeat(3,300px)","grid-template-rows":"400px","column-gap":"100px","justify-content":"space-around"}},ve=["onClick"],we={style:{width:"100%",height:"300px"}},be=["src"],ke={class:"tagselect-onetype-title"},Ve=S(()=>l("div",null,null,-1));function Ce(t,o,x,j,e,a){const p=u("TeacherHeadBar"),f=u("TeacherMenu"),v=u("ToolSelectMan");return r(),m("div",null,[i(p),l("div",me,[l("div",null,[i(f)]),l("div",pe,[ce,l("div",_e,[e.tagid>0?(r(),m("span",{key:0,style:{cursor:"pointer"},onClick:o[0]||(o[0]=(...c)=>a.cancelTag&&a.cancelTag(...c))},"类别")):_("",!0),e.tagid>0?(r(),m("span",ge,"   >>   ")):_("",!0),e.tagid>0?(r(),m("span",he,d(e.tagname),1)):_("",!0)]),l("div",fe,[e.tagid==0?(r(),m("div",ye,[l("div",xe,[(r(!0),m(T,null,L(e.labellist,c=>(r(),m("div",null,[l("div",{class:"tagselect-onetype",onClick:w=>a.chooseTag(c.lowerLabel[0])},[l("div",we,[l("img",{style:{height:"100%",width:"100%"},src:c.lowerLabel[0].url},null,8,be)]),l("h3",ke,d(c.lowerLabel[0].name),1)],8,ve)]))),256))])])):_("",!0),e.tagid>0?(r(),D(v,{key:1,tagid:e.tagid},null,8,["tagid"])):_("",!0)])]),Ve])])}const Me=C(ue,[["render",Ce],["__scopeId","data-v-13f50a81"]]);export{Me as default};
