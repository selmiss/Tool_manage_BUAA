{"remainingRequest":"/Users/fancy/工训中心工具管理/Tool_manage_BUAA/前端文件/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/fancy/工训中心工具管理/Tool_manage_BUAA/前端文件/src/views/student_views/BTSelectTool.vue?vue&type=style&index=0&id=2ed75149&scoped=true&lang=css&","dependencies":[{"path":"/Users/fancy/工训中心工具管理/Tool_manage_BUAA/前端文件/src/views/student_views/BTSelectTool.vue","mtime":1676082015380},{"path":"/Users/fancy/工训中心工具管理/Tool_manage_BUAA/前端文件/node_modules/css-loader/dist/cjs.js","mtime":1672908218146},{"path":"/Users/fancy/工训中心工具管理/Tool_manage_BUAA/前端文件/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1672908219119},{"path":"/Users/fancy/工训中心工具管理/Tool_manage_BUAA/前端文件/node_modules/postcss-loader/src/index.js","mtime":1672908218760},{"path":"/Users/fancy/工训中心工具管理/Tool_manage_BUAA/前端文件/node_modules/cache-loader/dist/cjs.js","mtime":1672908217846},{"path":"/Users/fancy/工训中心工具管理/Tool_manage_BUAA/前端文件/node_modules/vue-loader/lib/index.js","mtime":1672908219119}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi50YWdzZWxlY3Qtb25ldGFnewogIGN1cnNvcjogcG9pbnRlcjsKICB3aWR0aDogMTYwcHg7CiAgaGVpZ2h0OiAyNTBweDsKICBmb250LXNpemU6IDEuM2VtOwogIGJvcmRlci1yYWRpdXM6IDVweDsKICBib3gtc2hhZG93OiAwIDFweCAycHggMCByZ2JhKDAsIDAsIDAsIDAuMiksIDAgMnB4IDVweCAwIHJnYmEoMCwgMCwgMCwgMC4xOSk7CiAgZm9udC1mYW1pbHk6ICflrovkvZMnOwp9Ci5ib3Jyb3ctdG9vbC10aXRsZXsKICBmb250LXdlaWdodDogYm9sZDsKICBmb250LXNpemU6IDJlbTsKICBjb2xvcjogIzAwNjZjYzsKfQouYm9ycm93LXRvb2wtdGV4dHsKICBmb250LXNpemU6IDEuNWVtOwogIGZvbnQtZmFtaWx5OiAn5a6L5L2TJzsKfQo="},{"version":3,"sources":["BTSelectTool.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"BTSelectTool.vue","sourceRoot":"src/views/student_views","sourcesContent":["<template>\n  <div style=\"width:100%;display: grid;grid-template-rows: 40px auto;row-gap: 30px;\">\n    <div style=\"display: grid;grid-template-columns: 20% 40% 40%;align-items: center\">\n      <span>共 {{rescount}} 条结果</span>\n      <span>\n        <el-input\n            style=\"width: 400px;margin-left:100px;\"\n            placeholder=\"支持模糊搜索工具名称\"\n            v-model=\"searchkey\"\n            @keyup.enter.native=\"searchtool\"\n        >\n          <el-button slot=\"append\" icon=\"el-icon-search\" @click=\"searchtool\"></el-button>\n        </el-input>\n      </span>\n    </div>\n    <div style=\"display: grid;grid-template-columns: repeat(auto-fill,160px);grid-template-rows:repeat(auto-fill,250px);gap:30px 30px;\">\n      <div class=\"tagselect-onetag\" v-for=\"tool in tools\" @click=\"chooseTool(tool)\">\n        <div style=\"width: 150px;height: 150px;margin: 5px auto;\">\n          <img height=\"100%\" width=\"100%\" style=\"border-radius: 5px;\" :src=\"tool.url\"/>\n        </div>\n        <div style=\"height: 30px;line-height:30px;width: 160px;\">{{tool.name}}</div>\n        <div style=\"height: 40px;width: 160px;margin-top:10px;display:inline-block;\">\n          <el-button  size=\"small\" style=\"margin-top:5px;\"\n                      @click=\"ToolInfo(tool)\">详情</el-button>\n          <el-button type=\"primary\" size=\"small\" style=\"margin-top:5px;\"\n          @click=\"borrowTool(tool)\">借用</el-button>\n        </div>\n      </div>\n\n\n      <el-dialog\n          :visible.sync=\"dialogVisible\"\n          center\n          :modal=true\n          :append-to-body=true\n          width=\"700px\"\n          top=\"5px\"\n      >\n        <div v-if=\"borrowSuccess==false\" style=\"width:100%;display: grid;grid-template-rows: 100px 200px 50px auto 100px;justify-items: center\">\n          <div class=\"borrow-tool-title\">借用 {{thetool.name}}</div>\n          <div style=\"width: 200px;height: 200px;margin: 0 auto\"><img height=\"100%\" width=\"100%\" :src=thetool.url ></div>\n          <div class=\"borrow-tool-text\" style=\"line-height: 50px\">\n            <span>限借天数：{{thetool.limit_days}}</span>\n            <span>&nbsp 总数：{{thetool.totalCount}}</span>\n            <span>&nbsp 剩余数量：{{thetool.leftCount}}</span>\n            <span v-if=\"thetool.leftCount==0\">&nbsp归还时间：{{ thetool.shortReturnTime }}</span>\n          </div>\n          <div class=\"borrow-tool-text\" >\n              <el-form ref=\"thetool\" :model=\"thetool\" :rules=\"rules\" style=\"margin-top:3vh;line-height: 50px\" label-width=\"200px\">\n<!--                <el-form-item label=\"要借用此工具的数量\" prop=\"borrowCount\">-->\n<!--                  <el-input-number style=\"width: 100%\" v-model=\"thetool.borrowCount\" :max=thetool.leftCount :min=\"1\"></el-input-number>-->\n<!--                </el-form-item>-->\n                <el-form-item label=\"借用时间\" prop=\"duration\">\n                  <el-date-picker\n                      v-model=\"thetool.duration\"\n                      type=\"daterange\"\n                      range-separator=\"至\"\n                      start-placeholder=\"开始借用日期\"\n                      end-placeholder=\"归还日期\"\n                      @change=\"changeDuration\"\n                  >\n                  </el-date-picker>\n<!--                  <el-date-picker type=\"date\" placeholder=\"选择日期\" v-model=\"thetool.begin\" style=\"width: 300px\"></el-date-picker>-->\n                </el-form-item>\n<!--                <el-form-item label=\"借用结束时间\" prop=\"end\">-->\n<!--                  <el-date-picker type=\"date\" placeholder=\"选择日期\" v-model=\"thetool.end\" style=\"width: 300px\" ></el-date-picker>-->\n<!--                </el-form-item>-->\n                <el-form-item label=\"借用理由\" prop=\"purpose\">\n                  <el-input\n                      type=\"textarea\"\n                      :rows=\"2\"\n                      style=\"width: 300px\"\n                      placeholder=\"请输入内容\"\n                      v-model=\"thetool.purpose\">\n                  </el-input>\n                </el-form-item>\n                <div style=\"display: flex;justify-content: space-evenly\">\n                  <el-button @click=\"dialogVisible = false\">取 消</el-button>\n                  <el-button type=\"primary\" @click=\"confirmBorrow\">确 定</el-button>\n                </div>\n              </el-form>\n          </div>\n        </div>\n        <el-result v-else icon=\"success\" title=\"借用工具成功\" sub-title=\"请关注相关提醒邮件\" >\n          <template slot=\"extra\">\n            <el-button type=\"primary\" size=\"medium\" @click=\"dialogVisible=false\">返回工具页</el-button>\n          </template>\n        </el-result>\n      </el-dialog>\n\n      <el-dialog\n          :visible.sync=\"Infodialog\"\n          center\n          :modal=true\n          :append-to-body=true\n          width=\"700px\"\n          top=\"5px\"\n      >\n        <div style=\"width:100%;display: grid;grid-template-rows: 100px 200px 50px auto 100px;justify-items: center\">\n          <div class=\"borrow-tool-title\">{{thetool.name}}</div>\n          <div style=\"width: 200px;height: 200px;margin: 0 auto\"><img height=\"100%\" width=\"100%\" :src=thetool.url ></div>\n          <div class=\"borrow-tool-text\" style=\"line-height: 50px\">\n            <span>限借天数：{{thetool.limit_days}}</span>\n            <span>&nbsp 总数：{{thetool.totalCount}}</span>\n            <span>&nbsp 剩余数量：{{thetool.leftCount}}</span>\n            <span v-if=\"thetool.leftCount==0\">&nbsp归还时间：{{ thetool.shortReturnTime }}</span>\n          </div>\n          <div class=\"borrow-tool-text\" style=\"display: grid;grid-template-columns: 100px 400px\">\n            <div style=\"font-weight: bold\">详情介绍:</div>\n            <div>{{thetool.intro}}</div>\n          </div>\n        </div>\n      </el-dialog>\n    </div>\n\n\n  </div>\n</template>\n<script>\nimport axios from \"axios\";\nexport default{\n  name:\"BTSelectTool\",\n  components:{},\n  created(){},\n  mounted(){\n    this.init()\n  },\n  props:['tagid'],\n\n  data(){\n    return {\n      searchkey:'',\n      tools:[],\n      totoftags:1,\n\n      rescount:0,\n      dialogVisible:false,\n      thetool:{\n        name:'',\n        totalCount:null,\n        leftCount:null,\n        borrowCount:1,\n        begin:'',\n        end:'',\n        purpose:'',\n      },\n\n      Infodialog:false,\n\n      borrowSuccess:false,\n\n      rules: {\n        borrowCount: [\n          // {required: true,message: '请填写借用数量', trigger: 'blur'},\n          // {type: 'number',  message: '借用数量必须为正整数'},\n        ],\n        duration:[\n          {required: true, message: '请选择借用的时段', trigger: 'blur'},\n        ],\n        purpose:[\n          {required: true, message: '请填写借用理由', trigger: 'blur'},\n        ],\n      },\n    }\n  },\n  methods:{\n    init(){\n      axios({\n        url: \"user/getLabelToolList\",\n        method: \"post\",\n        data: {\n          labelId: this.tagid,\n        },\n      }).then((res) => {\n        if(res.data.error_code==0){\n          console.log(res);\n          this.tools=res.data.toolList;\n          this.rescount=res.data.toolList.length;\n        }else{\n          console.log(error);\n        }\n      }).catch(err=>{console.log(err)})\n    },\n    ToolInfo(tool){\n      this.thetool=tool;\n      this.Infodialog=true;\n    },\n    borrowTool(tool){\n      this.thetool=tool;\n      this.thetool.borrowCount=1;\n      this.borrowSuccess=false;\n      this.dialogVisible=true;\n    },\n    formatDate(date){\n      let formatted_data=date.getFullYear()+\"-\"+(date.getMonth()+1)+\"-\"+date.getDate();\n      return formatted_data;\n    },\n    changeDuration(d){\n      this.thetool.begin=d[0];\n      this.thetool.end=d[1];\n    },\n    confirmBorrow(){\n      this.$refs[\"thetool\"].validate(val=>{\n        if(val){\n          axios({\n            url: \"user/borrowRequest\",\n            method: 'post',\n            data: {\n              toolId: this.thetool.id,\n              uid:localStorage.getItem('uid'),\n              // borrowCount: Number(this.thetool.borrowCount),\n              borrowCount:1,\n              returnTime:this.formatDate(this.thetool.end),\n              startTime:this.formatDate(this.thetool.begin),\n              purpose:this.thetool.purpose\n            }\n          }).then(res=>{\n            console.log(\"Miaomiaomiao\",res)\n            if(res.data.error_code==0){\n              this.borrowSuccess=true;\n            }else if(res.data.error_code==4){\n              this.$message.warning(\"借用时长超过限定期限\")\n            }else if(res.data.error_code==5){\n\t\t\t\tthis.$message.warning(\"你已经借用过这个工具了\");\n\t\t\t}\n\t\t\telse{\n              this.$message.error(\"错误代码\",res.data.error_code);\n            }\n          }).catch(err=>{\n            this.$message.error(\"系统安全错误，请重试！\",err)\n          })\n        }\n        else{\n          this.$message.error(\"输入错误\",err)\n        }\n      })\n\n    },\n    searchtool(){\n      if(this.searchkey.length<1) {\n        this.init();\n      }else{\n        axios({\n          url:'user/searchToolByName',\n          method:'post',\n          data:{\n            toolName:this.searchkey,\n          }\n        }).then(res=>{\n          this.tools=res.data.dataList;\n          this.rescount=res.data.dataList.length;\n        }).catch(err=>{\n          this.$message.error(err)\n        })\n      }\n    },\n    chooseTool(tool){\n      console.log(tool)\n\n    }\n  }\n}\n</script>\n\n<style scoped>\n.tagselect-onetag{\n  cursor: pointer;\n  width: 160px;\n  height: 250px;\n  font-size: 1.3em;\n  border-radius: 5px;\n  box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.2), 0 2px 5px 0 rgba(0, 0, 0, 0.19);\n  font-family: '宋体';\n}\n.borrow-tool-title{\n  font-weight: bold;\n  font-size: 2em;\n  color: #0066cc;\n}\n.borrow-tool-text{\n  font-size: 1.5em;\n  font-family: '宋体';\n}\n</style>"]}]}